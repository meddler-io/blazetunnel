<!-- <div mat-subheader>Application</div> -->

<mat-accordion  >



    <ng-container *ngIf="applications ;  else loading">

        <mat-expansion-panel (opened)="opened(app.id)" (opened)="closed(app.id)" *ngFor="let app of applications "
            hideToggle>
            <mat-expansion-panel-header>
                <mat-panel-title fxLayout="column" fxLayoutAlign="center start">

                        {{app.app_name  }}

                </mat-panel-title>

                <mat-panel-description fxLayout="column" fxLayoutAlign="center end">

                    <div fxLayout="row" fxLayoutAlign="center center">
                        <mat-slide-toggle (change)="enableApp(app.id , $event.checked)"
                            [checked]="app?.enabled || false" (click)="$event.stopPropagation();"
                            labelPosition="before">
                        </mat-slide-toggle>

                        <button (click)="$event.stopPropagation();" mat-icon-button [matMenuTriggerFor]="menu">
                            <mat-icon>more_vert</mat-icon>
                        </button>


                        <mat-menu #menu="matMenu">
                            <button (click)="delete(app.id)" mat-menu-item>Delete</button>

                        </mat-menu>
                    </div>


                </mat-panel-description>

            </mat-expansion-panel-header>





            <div fxGap="1rem">
                <mat-divider class="divider"></mat-divider>

                
                <button (click)="openServiceCreationDialog(app)" class="create" color="accent" mat-raised-button>Create
                    service</button>


                <ng-container *ngIf=" serviceList$ | async as services  ; else loading ">








                    <ng-container *ngIf="services && services.length > 0">


                        <mat-divider class="divider"></mat-divider>


                        <div mat-subheader>Services</div>

                        <mat-list class="list">

                            <ng-container>




                                <mat-list-item class=" item" *ngFor="let data of services ">

                                    <!-- <mat-icon mat-list-icon>folder</mat-icon> -->
                                    <!-- <div mat-line>
                                        <button fxFlex fxFill class="textbtn"
                                            (click)="openServiceDetailDialog(  app.id , data.id ) ; $event.stopPropagation();"
                                            mat-button>
                                            {{data?.service_name}}
                                        </button>
                                    </div> -->
                                    <div mat-line>
                                        <a 
                                        (click)="openServiceDetailDialog(  app.id , data.id ) ; $event.stopPropagation();"
                                        
                                        fxFlex fxFill class="textbtn"


                                            mat-button>
                                            {{app?.app_name}}-{{data?.service_name}}.blazetunnel.meddler.xyz
                                    </a>
                                    </div>

                                    <a
                                    target="_blank" [href]="'//' +   app?.app_name + '-' + data?.service_name + '.blazetunnel.meddler.xyz'" 
                                        mat-button>
                                        <mat-icon>north_east</mat-icon>
                                </a>

                                    <mat-slide-toggle [disabled]="! ( app?.enabled || false)"
                                        [checked]="data?.enabled || false"
                                        (change)="enableService(app.id, data.id , $event.checked)" class="right"
                                        labelPosition="before">
                                    </mat-slide-toggle>

                                    <button (click)="$event.stopPropagation();" mat-button
                                        [matMenuTriggerFor]="menu">
                                        <mat-icon>more_vert</mat-icon>
                                    </button>


                                    <mat-menu #menu="matMenu">
                                        <button (click)="deleteService( app.id, data.id  )"
                                            mat-menu-item>Delete</button>

                                        <button (click)="deleteService( app.id, data.id  )"
                                            mat-menu-item>Export</button>

                                    </mat-menu>

                                </mat-list-item>

                            </ng-container>
                        </mat-list>



                    </ng-container>



                </ng-container>




            </div>
        </mat-expansion-panel>
    </ng-container>
</mat-accordion>

<ng-template #loading>

    <div fxLayout="column" diameter="50" class="loader" fxLayoutAlign="center center">
        <mat-spinner></mat-spinner>
    </div>



</ng-template>